{{- $item:= .Get "item" -}}
{{- $includeStr:= .Get "include" -}}
{{- $excludeStr:= .Get "exclude" -}}

{{- if not $item -}}
  {{- errorf "Missing required 'item' in shortcode: 'zarfprops'." -}}
{{- end -}}

{{/* Default to empty include & exclude slices */}}
{{ .Scratch.Set "includeSlice" (slice "") }}
{{ .Scratch.Set "excludeSlice" (slice "") }}

{{/* Convert the passed strings to slices if they exist */}}
{{- if $includeStr -}}
  {{ .Scratch.Set "includeSlice" (split $includeStr "," ) }}
{{- end -}}

{{- if $excludeStr -}}
  {{ .Scratch.Set "excludeSlice" (split $excludeStr "," ) }}
{{- end -}}

{{ $include := .Scratch.Get "includeSlice" }}
{{ $exclude := .Scratch.Get "excludeSlice" }}

{{ $schema := $.Site.Data.zarf_schema }}
{{- $itemSchema := index $schema.definitions $item -}}
{{- if $itemSchema -}}
  <table class="table table-striped table-responsive" aria-label="{{ $item }}">
    <thead>
      <tr>
        <th>Field</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      {{ range $key, $value := $itemSchema.properties }}
        <tr>
          <td>
            <code>{{ $key }}</code>
            {{ if in $itemSchema.required $key }}<em>*</em>{{ end }}
          </td>
          <td>
            {{ $value.type }}
          </td>
          <td>
            {{ $value.description }}
          </td>
        </tr>
      {{ end }}
    </tbody>
  </table>
{{- else -}}
  {{ errorf "Cannot get the value of the variable %s " $item }}
{{- end -}}


<!-- <table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    {$itemSchema && Object.keys($itemSchema.properties) .filter(includesElement) .sort() .sort((key) =>
    ($itemSchema.required.includes(key) ? -1 : 1)) .map((key) => { return (
    <tr key="{key}">
      <td>
        <code>{key}</code>
        {$itemSchema.required.includes(key) && <em>*</em>}
      </td>
      <td>
        <em>{$itemSchema.properties[key].type ?? "object"}</em>
      </td>
      <td>{$itemSchema.properties[key].description}</td>
    </tr>
    ); })}
  </tbody>
</table>
{$itemSchema && $itemSchema.required && $itemSchema.required.some(includesElement) && (
<small>
  <em>* Required field</em>
  <br />&nbsp;
</small>
)} -->
